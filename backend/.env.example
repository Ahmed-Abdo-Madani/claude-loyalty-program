# ========================================
# MADNA LOYALTY PLATFORM - ENVIRONMENT VARIABLES
# ========================================
# This file documents all environment variables used in production.
# Copy this file to .env for local development and fill in your values.
# NEVER commit actual secrets to version control!
# ========================================

# ----------------------------------------
# Node Environment
# ----------------------------------------
NODE_ENV=development
# Production: NODE_ENV=production

# ----------------------------------------
# Server Configuration
# ----------------------------------------
PORT=3001
BASE_URL=http://localhost:3001
# Production: BASE_URL=https://api.madna.me

FRONTEND_URL=http://localhost:3000
# Production: FRONTEND_URL=https://app.madna.me

# ----------------------------------------
# Prerender.io Configuration (Optional)
# ----------------------------------------
# Enables server-side rendering for social media crawlers (WhatsApp, Facebook, Twitter)
# Without this, social media previews will use fallback meta tags from index.html
# Sign up at https://prerender.io to get a token
PRERENDER_TOKEN=
# Production: PRERENDER_TOKEN=your_prerender_io_token_here
# This ensures crawlers receive fully rendered HTML with route-specific meta tags

# ----------------------------------------
# Database Configuration
# ----------------------------------------
# Use DATABASE_URL for PostgreSQL connection (recommended for Render/Heroku)
DATABASE_URL=postgresql://username:password@localhost:5432/loyalty_platform
# Production format: postgresql://user:pass@host/database
# Example: postgresql://madna_admin:password@dpg-xxxxx-a/madna_loyalty_platform

# ----------------------------------------
# Security - JWT & Session Secrets
# ----------------------------------------
# ⚠️ CRITICAL: Generate strong secrets for production!
# Generate with: openssl rand -base64 32 (for JWT_SECRET)
# Generate with: openssl rand -base64 64 (for SESSION_SECRET)

JWT_SECRET=dev-jwt-secret-change-in-production-min-32-chars
# Production example: 9c?Nj-T{2-gtaeY17TkkR064hX87MQ$p)W5wxpgru+CTU,rMY76HSr#RMH@m,[LA
# Minimum length: 32 characters
# Used for admin/branch manager authentication tokens

SESSION_SECRET=dev-session-secret-change-in-production-min-64-chars
# Production example: [3*:SE*N)U1_ZEP1vCTg{G=Dy#jk)+kCjwp.vE}&/{?.Zbh(FM9Sejr)7q])6:%$
# Used for session cookie signing

ENCRYPTION_KEY=dev-encryption-key-change-in-production-32-chars
# Production example: -$bWq!k)8z{$uxNMxdhS5-ze[-T7D4E@
# Used for encrypting sensitive data in database

# ----------------------------------------
# QR Code Security
# ----------------------------------------
QR_JWT_SECRET=dev-qr-jwt-secret-change-in-production-min-64-chars
# Generate with: openssl rand -base64 64
# CRITICAL: This secret signs QR codes and must be persistent across restarts
# If changed, all existing QR codes will become invalid
# Production: Use a strong 64+ character secret

# ----------------------------------------
# Apple Wallet Configuration
# ----------------------------------------
APPLE_TEAM_ID=YOUR_TEAM_ID
# Production: NFQ6M7TFY2
# Find in Apple Developer Account > Membership

APPLE_PASS_TYPE_ID=pass.com.yourcompany.loyalty
# Production: pass.me.madna.api
# Must match the Pass Type ID registered in Apple Developer

# Apple Pass Certificate (P12 format)
# Development: Use file path
APPLE_PASS_CERTIFICATE_PATH=./certificates/pass.p12
APPLE_PASS_CERTIFICATE_PASSWORD=your_p12_password
# Production: Watashi12Des

# Production: Use base64-encoded certificate (recommended for Render/Heroku)
# APPLE_PASS_CERTIFICATE_BASE64=MIIM9wIBAzCCDKUGCSqGSIb3DQEHAa...
# Alternative names also supported:
# APPLE_CERT_P12_BASE64=...
# Generate with: base64 -i certificates/pass.p12 | tr -d '\n'

# Apple WWDR Certificate (PEM format)
APPLE_WWDR_CERTIFICATE_PATH=./certificates/AppleWWDRCAG4.pem
# Production: Use base64-encoded certificate
# APPLE_CERT_WWDR_BASE64=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t...
# Generate with: base64 -i certificates/AppleWWDRCAG4.pem | tr -d '\n'

# ----------------------------------------
# Apple Push Notification Service (APNs)
# ----------------------------------------
# CRITICAL: APNs uses the SAME certificate as Apple Wallet pass signing
# The Pass Type ID certificate (.p12) serves dual purpose:
#   1. Signing pass manifests (PKCS7 signatures)
#   2. Sending APNs push notifications to update passes
#
# APNS_TOPIC MUST equal APPLE_PASS_TYPE_ID (required by Apple's spec)
APNS_TOPIC=pass.me.madna.api
# Production: pass.me.madna.api (MUST match APPLE_PASS_TYPE_ID exactly)

# APNs requires production environment for Wallet passes (sandbox doesn't work)
APNS_PRODUCTION=true
# Production: true (REQUIRED - sandbox doesn't support Wallet pass updates)

# ----------------------------------------
# Understanding Apple Wallet Notifications
# ----------------------------------------
# IMPORTANT: APNs push notifications for Wallet passes are SILENT BY DEFAULT
# This is Apple's intentional design to prevent notification spam.
#
# How it works:
#   1. Backend sends push notification with EMPTY PAYLOAD ({})
#   2. Device fetches updated pass from webServiceURL in background
#   3. Pass updates silently - user sees changes when opening Wallet app
#
# For VISIBLE NOTIFICATIONS (lock screen alerts):
#   - Add "changeMessage" property to fields in pass.json
#   - Only triggers when field value actually changes
#   - Example: changeMessage: "Congratulations! You are now %@"
#   - See backend/controllers/appleWalletController.js for implementation
#
# TWO TYPES OF NOTIFICATIONS:
#   1. Progress updates - triggered by tier/completion changes (existing changeMessage fields)
#   2. Custom messages - triggered by dynamic back field changes (new feature)
#
# What APNs configuration controls:
#   ✅ DELIVERY of push notifications to devices (enabled/disabled)
#   ❌ NOT visibility of notifications to users (controlled by changeMessage)
#
# Testing notifications:
#   - Use real iOS device (simulator doesn't support APNs)
#   - Check iOS Settings → Wallet → Notifications (must be enabled)
#   - Silent updates work even if notifications are disabled
#
# ----------------------------------------
# Apple Wallet Custom Messages
# ----------------------------------------
# Custom messages are stored in a dynamic back field with changeMessage property
# Each message includes a timestamp to ensure the field value changes
# This triggers visible lock-screen notifications when messages are sent
# Format: "[timestamp] header: body" (timestamp ensures uniqueness)
# Rate limiting: Tracked in wallet_passes.notification_history (default: 10/day)
#
# Custom message notification example:
# When sendCustomMessage(serialNumber, "Welcome", "Thank you!") is called:
#   1. Pass regenerated with back field: "[2025-11-03T08:53:14Z] Welcome: Thank you!"
#   2. APNs push sent to registered devices
#   3. Device fetches updated pass
#   4. iOS shows notification: "New message: [timestamp] Welcome: Thank you!"
#   5. User taps → Wallet opens → sees message in back fields
#
# Documentation: docs/APPLE-APNS-CERTIFICATE-SETUP.md

# Certificate Configuration (multiple supported env var names for flexibility)
# Option 1: Base64-encoded certificate (RECOMMENDED for production)
APPLE_PASS_CERTIFICATE_BASE64=<base64-encoded-p12-file>
# Alternatives: APPLE_APNS_CERT_BASE64 or APNS_CERT_BASE64
# Production: Use same certificate as pass signing

# Certificate password (multiple supported names)
APPLE_PASS_CERTIFICATE_PASSWORD=Watashi12Des
# Alternatives: APNS_CERT_PASSWORD or APPLE_APNS_CERT_PASSWORD

# Option 2: File path (for local development only)
# APNS_CERT_PATH=./certificates/pass-cert.p12
# Alternatives: APPLE_APNS_CERT_PATH or APPLE_PASS_CERTIFICATE_PATH

# Production Configuration Example:
# APNS_TOPIC=pass.me.madna.api
# APNS_PRODUCTION=true
# APPLE_PASS_CERTIFICATE_BASE64=<base64-p12-content>
# APPLE_PASS_CERTIFICATE_PASSWORD=Watashi12Des
#
# Note: This reuses the existing Pass Type ID certificate - no separate APNs cert needed!
# Documentation: docs/APPLE-APNS-CERTIFICATE-SETUP.md


# ----------------------------------------
# Google Wallet Configuration
# ----------------------------------------
GOOGLE_PROJECT_ID=your-google-project-id
# Production: madna-platform

GOOGLE_ISSUER_ID=3388000000000000000
# Production: 3388000000023017940
# Find in Google Pay & Wallet Console

GOOGLE_SERVICE_ACCOUNT_EMAIL=your-service-account@your-project.iam.gserviceaccount.com
# Production: platform-admin@madna-platform.iam.gserviceaccount.com

# Google Service Account Private Key
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
# Production: Set via environment variable (multi-line string)
# Escape newlines as \n in the key

# Google Application Credentials (JSON file path)
GOOGLE_APPLICATION_CREDENTIALS=./certificates/google-service-account.json
# Production: /etc/secrets/madna-platform-d8bf716cd142.json
# For Render: Upload as secret file

# ----------------------------------------
# Moyasar Payment Gateway Configuration
# ----------------------------------------
# Moyasar is the payment processor for subscription billing
# Sign up at https://moyasar.com and get API keys from dashboard
# Documentation: https://docs.moyasar.com/api/

MOYASAR_SECRET_KEY=sk_test_your_secret_key_here
# Production: sk_live_xxxxxxxxxxxxxxxxxxxxx
# CRITICAL: Keep this secret! Used for server-side payment operations
# Find in Moyasar Dashboard → Settings → API Keys
# Used for: Creating payments, verifying payments, processing refunds
# NOTE: Moyasar amounts are in smallest unit (halalas for SAR: 1 SAR = 100 halalas)

MOYASAR_PUBLISHABLE_KEY=pk_test_your_publishable_key_here
# Production: pk_live_xxxxxxxxxxxxxxxxxxxxx
# Safe to expose in frontend code
# Used for: Client-side tokenization (if implementing custom payment forms)
# Find in Moyasar Dashboard → Settings → API Keys
#
# KEY FORMAT REQUIREMENTS (CRITICAL):
# - MUST start with pk_test_ (sandbox) or pk_live_ (production)
# - Example: MOYASAR_PUBLISHABLE_KEY=pk_test_abc123def456ghi789jkl012mno345pqr
# - Invalid format will cause payment form to fail with "Invalid Publishable API Key" error
# - To verify format: echo $MOYASAR_PUBLISHABLE_KEY | grep -E '^pk_(test|live)_'

# Payment Configuration
MOYASAR_CURRENCY=SAR
# Default currency for payments (ISO 4217 code)
# Moyasar supports: SAR, USD, EUR, etc.

MOYASAR_CALLBACK_URL=http://localhost:3000/subscription/payment-callback
# Development (Vite): http://localhost:5173/subscription/payment-callback
# Development (CRA): http://localhost:3000/subscription/payment-callback
# Production: https://app.madna.me/subscription/payment-callback
# URL where users are redirected after payment completion
# Must be publicly accessible for Moyasar to redirect users
# The callback URL must match your frontend dev server port (usually 3000 for CRA, 5173 for Vite)

# IMPORTANT FOR LOCALHOST DEVELOPMENT:
# Moyasar's embedded form (Moyasar.init) works on localhost without special configuration.
# The CORS error "Access to script at 'https://cdn.moyasar.com/mpf/1.7.3/moyasar.js' blocked"
# typically occurs when loading the script dynamically from React.
# 
# SOLUTION: Load the script statically in index.html <head> section:
#   <script src="https://cdn.moyasar.com/mpf/1.7.3/moyasar.js"></script>
# 
# For localhost callback URL, use:
#   MOYASAR_CALLBACK_URL=http://localhost:3000/subscription/payment-callback

# Webhook Configuration
MOYASAR_WEBHOOK_SECRET=whsec_your_webhook_secret_here
# Production: whsec_xxxxxxxxxxxxxxxxxxxxx
# Used to verify webhook signatures from Moyasar
# Find in Moyasar Dashboard → Settings → Webhooks
# CRITICAL: Set this to enable real-time payment notifications
# NOTE: Enable tokenization in Moyasar dashboard for recurring billing support

# Webhook URL Configuration
MOYASAR_WEBHOOK_URL=http://localhost:3001/api/webhooks/moyasar
# Development: http://localhost:3001/api/webhooks/moyasar
# Production: https://api.madna.me/api/webhooks/moyasar
# This URL must be publicly accessible for Moyasar to send webhook events
# For local development, use ngrok or similar tunneling service:
#   ngrok http 3001
#   Then set: MOYASAR_WEBHOOK_URL=https://your-ngrok-url.ngrok.io/api/webhooks/moyasar

# ========================================
# MOYASAR WEBHOOK SETUP INSTRUCTIONS
# ========================================
# Webhooks provide real-time payment notifications for instant subscription activation
# and failure handling, complementing the daily recurring billing cron job.
#
# Setup Steps:
# 1. Log in to Moyasar Dashboard (https://dashboard.moyasar.com)
# 2. Navigate to Settings → Webhooks
# 3. Click "Add Webhook Endpoint"
# 4. Enter webhook URL:
#    - Development: Use ngrok tunnel URL (e.g., https://abc123.ngrok.io/api/webhooks/moyasar)
#    - Production: https://api.madna.me/api/webhooks/moyasar
# 5. Select events to receive:
#    ✅ payment.paid (REQUIRED - activates subscriptions immediately)
#    ✅ payment.failed (REQUIRED - handles payment failures with retry logic)
#    ✅ payment.refunded (REQUIRED - processes refunds and cancellations)
#    ⚠️  payment.authorized (optional - for pre-authorization flows)
#    ⚠️  payment.captured (optional - for capture after authorization)
# 6. Copy the webhook secret (starts with whsec_) and set MOYASAR_WEBHOOK_SECRET
# 7. Save webhook configuration
# 8. Test webhook delivery using Moyasar dashboard test feature
#
# Webhook Event Flow:
# 1. User completes payment on Moyasar checkout
# 2. Moyasar sends webhook to /api/webhooks/moyasar
# 3. Backend verifies HMAC signature using MOYASAR_WEBHOOK_SECRET
# 4. Backend processes event (activate subscription, handle failure, etc.)
# 5. Backend returns 200 OK to acknowledge receipt
# 6. Moyasar retries failed webhooks with exponential backoff (up to 3 days)
#
# Webhook vs Cron Job:
# - Webhooks: Real-time updates (instant subscription activation)
# - Cron Job: Scheduled renewals (daily at 2:00 AM UTC)
# - Both work together: Webhooks for user-initiated payments, cron for recurring billing
#
# Troubleshooting:
# - Issue: "Webhook signature verification failed"
#   Fix: Verify MOYASAR_WEBHOOK_SECRET matches the secret in Moyasar dashboard
#        Ensure raw request body is preserved (express.raw middleware)
# - Issue: "Webhook not received"
#   Fix: Check webhook URL is publicly accessible (test with curl)
#        Verify firewall/security groups allow Moyasar IPs
#        Check Moyasar dashboard webhook logs for delivery attempts
# - Issue: "Duplicate webhook processing"
#   Fix: Idempotency is handled automatically using webhook event IDs
#        Check webhook_logs table for duplicate entries
# - Issue: "Payment not found in webhook handler"
#   Fix: Ensure payment record is created during checkout before Moyasar redirect
#        Check payment.moyasar_payment_id matches webhook payload
#
# Monitoring:
# - Check webhook_logs table for processing status and errors
# - Monitor webhook delivery in Moyasar dashboard
# - Set up alerts for failed webhook processing (status='failed')
# - Review webhook logs regularly for signature verification failures
#
# Security:
# - Webhook signature verification prevents unauthorized requests
# - MOYASAR_WEBHOOK_SECRET must be kept confidential
# - Webhook endpoint has no authentication middleware (signature is the auth)
# - Rate limiting applies to webhook endpoint (configured in server.js)
# ========================================

# Testing
# Test card numbers (Official Moyasar Test Cards):
# Mada Success Card: 4201320111111010 (Expected: Payment succeeds)
# Mada Failure Card: 4201320000013020 (Expected: Payment fails)
# Visa Success Card: 4111111111111111 (Expected: Payment succeeds)
# Visa Declined Card: 4000000000000002 (Expected: Payment declined)
# Mastercard Success Card: 5200000000000007 (Expected: Payment succeeds, may trigger 3D Secure)
#
# Important Notes:
# - All test cards require name with at least two words (e.g., "Test User")
# - Expiry must be any future month/year
# - CVC can be any 3 digits (4 for Amex)
# - Using cards NOT on Moyasar's official list will cause payment to fail
# - Reference: https://docs.moyasar.com/guides/card-payments/test-cards/
#
# Troubleshooting Common Test Card Issues:
# - Issue: "Payment failed with test card" → Verify card number matches Moyasar's official test cards exactly
# - Issue: "Invalid card number" → Check for typos, ensure no spaces in card number
# - Issue: "Payment declined" → This is expected behavior for failure test cards (4201320000013020, 4000000000000002)
# - Issue: "No redirect after payment" → Check browser console for Moyasar errors, verify callback URL is correct

# Common Payment Verification Issues:
# - Amount mismatch: Ensure amounts are stored in SAR (decimal) in database, converted to halalas (integer) for Moyasar
#   Example: 210 SAR = 21000 halalas. Rounding tolerance is 0.01 SAR (1 halala)
# - Payment not found: Check that payment record was created during checkout before Moyasar redirect
# - Status mismatch: Test cards may take a few seconds to transition to 'paid' status. Consider polling or retry logic.

# Debugging Payment Verification Issues:
# If you encounter payment verification failures:
# 1. Check backend logs for detailed verification issues (status match, amount match, currency match)
# 2. Use the debug endpoint in development: GET /api/business/subscription/payment-debug/:moyasarPaymentId
# 3. Verify amount conversion: Stored amount in SAR × 100 = Moyasar amount in halalas
# 4. Ensure test cards are from official Moyasar docs: https://docs.moyasar.com/guides/card-payments/test-cards/
# 5. Check that MOYASAR_SECRET_KEY and MOYASAR_PUBLISHABLE_KEY match (both test or both live)
# 6. In dev mode, frontend will show verification details and technical error information

# PAYMENT METHODS DOCUMENTATION:
# By default, only credit card payments are enabled in the checkout form.
# 
# To enable Apple Pay:
# - Requires merchant account with Apple
# - Requires domain verification in Apple Developer portal
# - Requires backend validation endpoint for merchant validation
# - Contact Moyasar support to activate Apple Pay on your account
# 
# To enable STC Pay:
# - Requires merchant agreement with STC Pay
# - Requires additional configuration in Moyasar dashboard
# - Contact Moyasar support to activate STC Pay on your account

# COMMON MOYASAR INTEGRATION ISSUES:
# 
# Issue 1: "Invalid Publishable API Key"
# Fix: Check key format starts with pk_test_ or pk_live_
#      Verify key is correct in Moyasar dashboard
#      Ensure no extra spaces or quotes in .env file
# 
# Issue 2: "Apple Pay label is required"
# Fix: Remove 'applepay' from methods array in CheckoutPage.jsx
#      Or add full Apple Pay configuration (requires merchant account)
#      Current implementation: Only credit card enabled by default
# 
# Issue 3: "Moyasar is not defined" or form not rendering
# Fix: Verify script loaded in index.html: <script src="https://cdn.moyasar.com/mpf/1.7.3/moyasar.js"></script>
#      Check browser console for script loading errors
#      Ensure not using dynamic script loading (causes CORS issues)
# 
# Issue 4: "Payment form failed to initialize"
# Fix: Check browser console for Moyasar.init() errors
#      Verify publishableKey format is valid
#      Check that amount is >= 100 halalas (1 SAR minimum)
# 
# Issue 5: CORS errors loading Moyasar script
# Fix: Use static script tag in index.html, NOT dynamic loading
#      Static: <script src="..."></script> in HTML <head>
#      DO NOT use: document.createElement('script') in React
# 
# Issue 6: Amount validation errors
# Fix: Moyasar expects amounts in smallest unit (halalas)
#      Conversion: 1 SAR = 100 halalas
#      Example: 210 SAR = 21000 halalas
# 
# Issue 7: Callback not working
# Fix: Ensure MOYASAR_CALLBACK_URL matches frontend URL exactly
#      Include protocol (http/https) and port number
#      Example: http://localhost:3000/subscription/payment-callback

# ----------------------------------------
# File Upload Configuration
# ----------------------------------------
UPLOADS_DIR=./uploads
# Production: /app/uploads
# Must be a persistent disk mount in production (Render persistent disk)

UPLOADS_BASE_URL=http://localhost:3001/uploads
# Production: https://api.madna.me/uploads
# Public URL for accessing uploaded files

ICONS_PATH=./uploads/icons/stamps
# Production: /app/uploads/icons/stamps
# Path for stamp icons used in loyalty cards

# ----------------------------------------
# Auto-Engagement Configuration
# ----------------------------------------
DISABLE_AUTO_ENGAGEMENT=false
# Set to 'true' to disable the daily auto-engagement cron job
# Useful for testing or temporary disabling

PASS_INACTIVITY_EXPIRATION_DAYS=90
# Days of inactivity before expiring completed passes
# Default: 90 days

# ----------------------------------------
# Notification Limits
# ----------------------------------------
WALLET_NOTIFICATION_DAILY_LIMIT=10
# Maximum wallet notifications per customer per day
# Prevents notification spam

# ----------------------------------------
# Schema Validation (Advanced)
# ----------------------------------------
# SKIP_SCHEMA_VALIDATION=false
# Set to 'true' to skip startup schema checks (emergency bypass only)
# Not recommended for production

# SKIP_SCHEMA_CHECKS=false
# Alternative name for SKIP_SCHEMA_VALIDATION

# ----------------------------------------
# Automatic Migration Configuration
# ----------------------------------------
AUTO_MIGRATE=true
# Set to 'false' to disable automatic migrations on startup
# Default: true in production, recommended to keep enabled
# When enabled, pending migrations run automatically before server starts
# When disabled, migrations must be run manually before deployment

MIGRATION_LOCK_TIMEOUT=30000
# Milliseconds to wait for migration advisory lock
# Default: 30000 (30 seconds)
# Increase if migrations take longer or deployments are slow

MIGRATION_STOP_ON_ERROR=true
# Stop migration execution on first error
# Default: true (recommended for production)
# Set to 'false' to continue running migrations even if one fails (not recommended)

# ========================================
# AUTOMATIC MIGRATION SYSTEM
# ========================================
# The platform now includes automatic migration tracking and execution.
# Migrations run automatically in two places:
#
# 1. Render preDeploy Command (Primary)
#    - Runs: node scripts/deploy-migrations.js
#    - When: After build, before traffic switches to new version
#    - Benefit: Zero-downtime deployments
#    - Requires: Render Starter plan or higher
#
# 2. Server Startup (Safety Net)
#    - Runs: AutoMigrationRunner.runPendingMigrations()
#    - When: During server initialization
#    - Benefit: Catches missed migrations, validates schema
#    - Controlled by: AUTO_MIGRATE environment variable
#
# Migration Tracking:
#    - Table: schema_migrations
#    - Tracks: Applied migrations, execution time, status, checksums
#    - Prevents: Duplicate execution, concurrent runs (advisory locks)
#
# Manual Migration (Emergency):
#    - Disable auto-migrations: AUTO_MIGRATE=false
#    - Run manually: npm run migrate:auto
#    - Check status: npm run migrate:status
#    - List pending: npm run migrate:pending
# ========================================

# ========================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ========================================
# Before deploying to production:
# ✅ Generate strong JWT_SECRET (min 32 chars)
# ✅ Generate strong SESSION_SECRET (min 64 chars)
# ✅ Generate strong ENCRYPTION_KEY (32 chars)
# ✅ Generate strong QR_JWT_SECRET (min 64 chars)
# ✅ Set NODE_ENV=production
# ✅ Set APNS_PRODUCTION=true
# ✅ Upload Apple certificates as base64 env vars
# ✅ Upload Google service account JSON as secret file
# ✅ Set MOYASAR_SECRET_KEY and MOYASAR_PUBLISHABLE_KEY (production keys)
# ✅ Verify MOYASAR_PUBLISHABLE_KEY starts with pk_live_ (not pk_test_)
# ✅ Configure MOYASAR_CALLBACK_URL with production domain
# ✅ Configure Moyasar webhook URL in dashboard (https://api.madna.me/api/webhooks/moyasar)
# ✅ Set MOYASAR_WEBHOOK_SECRET (matches dashboard webhook secret)
# ✅ Test webhook delivery using Moyasar dashboard test feature
# ✅ Enable payment.paid, payment.failed, and payment.refunded events in webhook settings
# ✅ Monitor webhook_logs table for processing errors
# ✅ Test payment form loads without errors in production environment
# ✅ Confirm only enabled payment methods are included in checkout
# ✅ Enable tokenization in Moyasar dashboard (for recurring billing)
# ✅ Configure persistent disk for UPLOADS_DIR
# ✅ Set correct BASE_URL and FRONTEND_URL
# ✅ Verify DATABASE_URL connection string
# ✅ AUTO_MIGRATE=true (enabled for automatic migrations)
# ✅ schema_migrations table created
# ✅ All pending migrations applied
# ========================================